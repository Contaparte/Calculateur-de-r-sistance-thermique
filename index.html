<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Résistance Thermique</title>
    <!-- Bibliothèques React -->
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <!-- Tailwind CSS pour le style -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Chart.js pour les graphiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Fonctions utilitaires
const rsiToR = (rsi) => {
  if (rsi === null || rsi === undefined || isNaN(rsi)) return null;
  return rsi * 5.678263;
};

const rToRsi = (r) => {
  if (r === null || r === undefined || isNaN(r)) return null;
  return r / 5.678263;
};

// Fonction pour formater les valeurs RSI et R
const formatRSIR = (rsi) => {
  if (rsi === null || rsi === undefined || isNaN(rsi)) return "—";
  const r = rsiToR(rsi);
  return `RSI ${rsi.toFixed(2)} (R ${r.toFixed(2)})`;
};

// Fonction pour calculer le point de rosée
const calculateDewPoint = (temperature, relativeHumidity) => {
  // Formule de calcul du point de rosée
  const a = 17.27;
  const b = 237.7;
  const alpha = ((a * temperature) / (b + temperature)) + Math.log(relativeHumidity / 100);
  return (b * alpha) / (a - alpha);
};

// Valeurs minimales RSI selon le Code de construction du Québec
const minRSIValues = {
  "< 6000": {
    "roof": 7.22,
    "wall_above_grade": 4.31,
    "foundation_wall": 2.99,
    "floor": 5.20,
    "garage_ceiling": 5.20,
    "garage_walls": 3.50
  },
  ">= 6000": {
    "roof": 9.00,
    "wall_above_grade": 5.11,
    "foundation_wall": 2.99,
    "floor": 5.20,
    "garage_ceiling": 5.20,
    "garage_walls": 3.50
  }
};

// Constantes pour les degrés-jours et les municipalités
const municipalities = [
  { id: "montreal", name: "Montréal", degreeDay: 4200, zone: "< 6000" },
  { id: "laval", name: "Laval", degreeDay: 4500, zone: "< 6000" },
  { id: "quebec", name: "Québec", degreeDay: 5080, zone: "< 6000" },
  { id: "gatineau", name: "Gatineau", degreeDay: 4600, zone: "< 6000" },
  { id: "sherbrooke", name: "Sherbrooke", degreeDay: 4700, zone: "< 6000" },
  { id: "trois-rivieres", name: "Trois-Rivières", degreeDay: 4900, zone: "< 6000" },
  { id: "rimouski", name: "Rimouski", degreeDay: 5300, zone: "< 6000" },
  { id: "gaspé", name: "Gaspé", degreeDay: 5500, zone: "< 6000" },
  { id: "matane", name: "Matane", degreeDay: 5510, zone: "< 6000" },
  { id: "amos", name: "Amos", degreeDay: 6160, zone: ">= 6000" },
  { id: "rouyn", name: "Rouyn", degreeDay: 6050, zone: ">= 6000" },
  { id: "val-dor", name: "Val-d'Or", degreeDay: 6180, zone: ">= 6000" },
  { id: "baie-comeau", name: "Baie-Comeau", degreeDay: 6020, zone: ">= 6000" },
  { id: "sept-iles", name: "Sept-Îles", degreeDay: 6200, zone: ">= 6000" },
  { id: "port-cartier", name: "Port-Cartier", degreeDay: 6060, zone: ">= 6000" },
  { id: "havre-st-pierre", name: "Havre-St-Pierre", degreeDay: 6100, zone: ">= 6000" },
  { id: "kuujjuaq", name: "Kuujjuaq", degreeDay: 8550, zone: ">= 6000" },
  { id: "schefferville", name: "Schefferville", degreeDay: 8550, zone: ">= 6000" }
];

// Base de données des matériaux avec leurs valeurs RSI par mm d'épaisseur
const materials = {
  // Films d'air
  airFilms: [
    { id: "exterior", name: "Film d'air extérieur", rsi: 0.03, description: "Pellicule d'air de surface (vent hivernal de 24 Km/h)" },
    { id: "interior_vertical", name: "Film d'air intérieur (mur)", rsi: 0.12, description: "Air stable, surface verticale, flux thermique horizontal" },
    { id: "interior_ceiling", name: "Film d'air intérieur (plafond)", rsi: 0.11, description: "Air stable, surface horizontale, flux thermique ascendant" },
    { id: "interior_floor", name: "Film d'air intérieur (plancher)", rsi: 0.16, description: "Air stable, surface horizontale, flux thermique descendant" }
  ],
  
  // Lames d'air non réfléchissantes
  airSpaces: [
    // Murs (flux thermique horizontal)
    { id: "airspace_wall_13mm", name: "Lame d'air dans un mur - 13mm", rsi: 0.16, description: "min. 13mm (1/2'')" },
    { id: "airspace_wall_20mm", name: "Lame d'air dans un mur - 20mm+", rsi: 0.18, description: "20mm (3/4'') et +" },
    { id: "airspace_wall_40mm", name: "Lame d'air dans un mur - 40mm+", rsi: 0.18, description: "40mm (1 1/2'') et +" },
    { id: "airspace_wall_90mm", name: "Lame d'air dans un mur - 90mm+", rsi: 0.18, description: "90mm (3 1/2'') et +" },
    
    // Plafonds (flux thermique ascendant)
    { id: "airspace_ceiling_13mm", name: "Lame d'air dans un plafond - 13mm", rsi: 0.15, description: "min. 13mm (1/2'')" },
    { id: "airspace_ceiling_20mm", name: "Lame d'air dans un plafond - 20mm+", rsi: 0.15, description: "20mm (3/4'') et +" },
    { id: "airspace_ceiling_40mm", name: "Lame d'air dans un plafond - 40mm+", rsi: 0.16, description: "40mm (1 1/2'') et +" },
    { id: "airspace_ceiling_90mm", name: "Lame d'air dans un plafond - 90mm+", rsi: 0.16, description: "90mm (3 1/2'') et +" },
    
    // Planchers (flux thermique descendant)
    { id: "airspace_floor_13mm", name: "Lame d'air dans un plancher - 13mm", rsi: 0.16, description: "min. 13mm (1/2'')" },
    { id: "airspace_floor_20mm", name: "Lame d'air dans un plancher - 20mm+", rsi: 0.18, description: "20mm (3/4'') et +" },
    { id: "airspace_floor_40mm", name: "Lame d'air dans un plancher - 40mm+", rsi: 0.2, description: "40mm (1 1/2'') et +" },
    { id: "airspace_floor_90mm", name: "Lame d'air dans un plancher - 90mm+", rsi: 0.22, description: "90mm (3 1/2'') et +" }
  ],
  
  // Lames d'air réfléchissantes
  reflectiveAirSpaces: [
    // Murs (flux thermique horizontal)
    { id: "reflective_wall_oneside", name: "Lame d'air réfléchissante dans un mur - parée d'un côté", rsi: 0.465, description: "Lame verticale parée d'un côté, flux thermique horizontal entre 13 et 19mm" },
    { id: "reflective_wall_bothsides", name: "Lame d'air réfléchissante dans un mur - parée de deux côtés", rsi: 0.48, description: "Lame verticale parée de deux côtés, flux thermique horizontal entre 13 et 19mm" },
    
    // Plafonds (flux thermique ascendant)
    { id: "reflective_ceiling_oneside", name: "Lame d'air réfléchissante dans un plafond - parée d'un côté", rsi: 0.324, description: "Lame horizontale parée d'un côté, flux thermique ascendant entre 13 et 19mm" },
    { id: "reflective_ceiling_bothsides", name: "Lame d'air réfléchissante dans un plafond - parée de deux côtés", rsi: 0.332, description: "Lame horizontale parée de deux côtés, flux thermique ascendant entre 13 et 19mm" },
    
    // Planchers (flux thermique descendant)
    { id: "reflective_floor_oneside", name: "Lame d'air réfléchissante dans un plancher - parée d'un côté", rsi: 0.98, description: "Lame horizontale parée d'un côté, flux thermique descendant entre 13 et 19mm" },
    { id: "reflective_floor_bothsides", name: "Lame d'air réfléchissante dans un plancher - parée de deux côtés", rsi: 1.034, description: "Lame horizontale parée de deux côtés, flux thermique descendant entre 13 et 19mm" }
  ],

    // Matériaux de charpente - Bois
  wood: [
    { id: "wood_spf", name: "Bois de construction courant (S-P-F)", rsiPerMm: 0.0085, description: "Bois de construction courant (Épinette-Pin-Sapin)" },
    { id: "wood_birch", name: "Bouleau", rsiPerMm: 0.0055, description: "Bouleau" },
    { id: "wood_oak", name: "Chêne", rsiPerMm: 0.0056, description: "Chêne" },
    { id: "wood_maple", name: "Érable", rsiPerMm: 0.0063, description: "Érable et frêne" },
    { id: "wood_cedar", name: "Cèdre blanc", rsiPerMm: 0.0099, description: "Cèdre blanc" },
    { id: "wood_cypress", name: "Cyprès jaune", rsiPerMm: 0.0077, description: "Cyprès jaune" },
    { id: "wood_spruce", name: "Épinette blanche", rsiPerMm: 0.0097, description: "Épinette blanche" },
    { id: "wood_pine_white", name: "Pin blanc", rsiPerMm: 0.0092, description: "Pin blanc" },
    { id: "wood_pine_lodgepole", name: "Pin lodgepole", rsiPerMm: 0.0082, description: "Pin lodgepole" },
    { id: "wood_pine_red", name: "Pin rouge", rsiPerMm: 0.0077, description: "Pin rouge" },
    { id: "wood_hemlock", name: "Pruche", rsiPerMm: 0.0084, description: "Pruche" },
    { id: "wood_hemlock_western", name: "Pruche de l'ouest", rsiPerMm: 0.0074, description: "Pruche de l'ouest" },
    { id: "wood_doug_fir", name: "Sapin de Douglas ou mélèze", rsiPerMm: 0.0069, description: "Sapin de Douglas ou mélèze" },
    { id: "wood_fir", name: "Sapin gracieux", rsiPerMm: 0.008, description: "Sapin gracieux" }
  ],
  
  // Béton
  concrete: [
    { id: "concrete_2400", name: "Béton 2400 kg/m³", rsiPerMm: 0.0004, description: "Béton coulé sur place, 2400 kg/m³ (150lbs/pi³)" },
    { id: "concrete_1600", name: "Béton léger 1600 kg/m³", rsiPerMm: 0.0013, description: "Béton léger, 1600 kg/m³ (100lbs/pi³) (schiste, argile ou ardoise expansés, laitier expansé, cendre)" }
  ],
  
  // Blocs de béton
  concreteBlocks: [
    { id: "block_90mm", name: "Bloc de béton - 90mm", rsi: 0.17, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) - 90mm" },
    { id: "block_140mm", name: "Bloc de béton - 140mm", rsi: 0.19, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) - 140mm" },
    { id: "block_190mm", name: "Bloc de béton - 190mm", rsi: 0.21, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) - 190mm" },
    { id: "block_240mm", name: "Bloc de béton - 240mm", rsi: 0.24, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) - 240mm" },
    { id: "block_290mm", name: "Bloc de béton - 290mm", rsi: 0.26, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) - 290mm" },
    { id: "block_perlite_190mm", name: "Bloc de béton avec perlite - 190mm", rsi: 0.53, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) remplis de perlite - 190mm" },
    { id: "block_vermiculite_140mm", name: "Bloc de béton avec vermiculite - 140mm", rsi: 0.4, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) remplis de vermiculite - 140mm" },
    { id: "block_vermiculite_190mm", name: "Bloc de béton avec vermiculite - 190mm", rsi: 0.51, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) remplis de vermiculite - 190mm" },
    { id: "block_vermiculite_240mm", name: "Bloc de béton avec vermiculite - 240mm", rsi: 0.61, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) remplis de vermiculite - 240mm" },
    { id: "block_vermiculite_290mm", name: "Bloc de béton avec vermiculite - 290mm", rsi: 0.69, description: "Blocs de béton à 2 cellules, béton lourds (2100kg/m³) remplis de vermiculite - 290mm" }
  ],
  
  // Revêtements d'ossature
  sheathing: [
    { id: "plywood", name: "Contreplaqué de bois tendre", rsiPerMm: 0.0087, description: "Contreplaqué de bois tendre" },
    { id: "particleboard", name: "Panneau de particules", rsiPerMm: 0.0077, description: "Panneau de particules" },
    { id: "osb", name: "Panneaux de copeaux (OSB)", rsiPerMm: 0.0098, description: "Panneaux de copeaux orientés (OSB)" },
    { id: "fiberboard_asphalt", name: "Revêtement en carton-fibre asphalté", rsiPerMm: 0.0165, description: "Revêtement en carton-fibre asphalté" },
    { id: "gypsum", name: "Revêtement en plaque de plâtre (gypse)", rsiPerMm: 0.0063, description: "Revêtement en plaque de plâtre (panneaux de gypse)" },
    { id: "paper", name: "Papier de revêtement", rsi: 0.011, description: "Papier de revêtement" },
    { id: "kraft_paper", name: "Papier vaporifuge kraft enduit d'asphalte", rsi: 0, description: "Papier vaporifuge kraft enduit d'asphalte - négligeable" },
    { id: "polyethylene", name: "Pare-vapeur en polyéthylène", rsi: 0, description: "Pare-vapeur en polyéthylène - négligeable" },
    { id: "reflective_fiberboard", name: "Panneau de fibre de bois avec pellicule réfléchissante", rsiPerMm: 0.0194, description: "Panneau de fibre de bois avec pellicule réfléchissante" },
    { id: "light_concrete", name: "Panneau de béton léger", rsiPerMm: 0.0069, description: "Panneau de béton léger (ex.: Permabase DEK de Unifix)" }
  ],

    // Isolants
  insulation: [
    { id: "fiberglass_thermal", name: "Laine de fibre de verre, usage thermique", rsiPerMm: 0.0208, description: "Laine de fibre de verre, usage thermique (Eco Touch thermique de Owens Corning)" },
    { id: "fiberglass_acoustic", name: "Laine de fibre de verre, usage acoustique", rsiPerMm: 0, description: "Laine de fibre de verre, usage acoustique (Eco Touch Quiétude de Owens Corning) - valeurs non fournies" },
    { id: "mineral_wool", name: "Laine de roche", rsiPerMm: 0.0276, description: "Laine de roche (Roxul Cavity Rock)" },
    { id: "benotherm", name: "BENO-THERM de Benolec", rsiPerMm: 0.025, description: "BENO-THERM de Benolec" },
    { id: "benospray", name: "BENO-SPRAY de Benolec", rsiPerMm: 0.024, description: "BENO-SPRAY de Benolec" },
    { id: "cellulose_blown", name: "Fibre cellulosique épandue (combles)", rsiPerMm: 0.0188, description: "Fibre cellulosique épandue (combles)" },
    { id: "cellulose_sprayed", name: "Fibre cellulosique pulvérisée", rsiPerMm: 0.019, description: "Fibre cellulosique pulvérisée" },
    { id: "mineral_blown", name: "Fibre minérale épandue (combles)", rsiPerMm: 0.015, description: "Fibre minérale épandue (combles)" },
    { id: "mineral_injected_89mm", name: "Fibre minérale injectée (murs), 89mm", rsi: 2.55, description: "Fibre minérale injectée (murs), 89mm (3 1/2'')" },
    { id: "mineral_injected_140mm", name: "Fibre minérale injectée (murs), 140mm", rsi: 4.05, description: "Fibre minérale injectée (murs), 140mm (5 1/2'')" },
    { id: "mineral_injected_152mm", name: "Fibre minérale injectée (murs), 152mm", rsi: 4.23, description: "Fibre minérale injectée (murs), 152mm (6'')" },
    { id: "fibrewood", name: "Fibre de bois", rsiPerMm: 0.023, description: "Fibre de bois" },
    { id: "asbestos", name: "Amiante pulvérisé", rsiPerMm: 0.0201, description: "Amiante pulvérisé (vieilles constructions)" },
    { id: "foamular", name: "Foamular C-200 ou Cdebord de Owens Corning", rsiPerMm: 0.0343, description: "Foamular C-200 ou Cdebord de Owens Corning" },
    { id: "polystyrene_type1", name: "Polystyrène expansé Type 1", rsiPerMm: 0.0257, description: "Polystyrène expansé Type 1" },
    { id: "polystyrene_type2", name: "Polystyrène expansé Type 2", rsiPerMm: 0.0277, description: "Polystyrène expansé Type 2" },
    { id: "polystyrene_type3", name: "Polystyrène expansé Type 3", rsiPerMm: 0.0298, description: "Polystyrène expansé Type 3" },
    { id: "polystyrene_type4", name: "Polystyrène expansé Type 4", rsiPerMm: 0.0347, description: "Polystyrène expansé Type 4" },
    { id: "rockwool_rigid", name: "Isolant rigide en laine de roche pour toit", rsiPerMm: 0.0277, description: "Isolant rigide en laine de roche pour toit" },
    { id: "extruded_polystyrene", name: "Polystyrène extrudé", rsiPerMm: 0.0257, description: "Polystyrène extrudé" },
    { id: "cork", name: "Liège naturel", rsiPerMm: 0.0257, description: "Liège naturel" },
    { id: "perlite_panel", name: "Panneau de perlite", rsiPerMm: 0.0187, description: "Panneau de perlite" },
    { id: "perlex", name: "Perlex de Lexcor", rsi: 0.49, description: "Perlex de Lexcor" },
    { id: "polyiso", name: "Panneau rigide de polyisocyanurate", rsiPerMm: 0.042, description: "Panneau rigide de polyisocyanurate (Sopra-Iso de Soprema)" },
    { id: "fibercement", name: "Panneau de fibrociment", rsi: 0.109, description: "Panneau de fibrociment (Finex)" },
    { id: "straw", name: "Panneau de paille comprimée", rsiPerMm: 0.0139, description: "Panneau de paille comprimée" },
    { id: "fiberboard_dry", name: "Panneau isolant de carton-fibre sec", rsiPerMm: 0.0194, description: "Panneau isolant de carton-fibre sec" },
    { id: "perlite_loose", name: "Perlite expansée, en vrac", rsiPerMm: 0.0187, description: "Perlite expansée, en vrac" },
    { id: "phenolic", name: "Panneau de mousse phénolique", rsiPerMm: 0.0304, description: "Panneau de mousse phénolique" },
    { id: "spray_polyurethane", name: "Polyuréthane giclé", rsiPerMm: 0.0455, description: "Polyuréthane giclé" },
    { id: "wood_fiber", name: "Matelas de fibre de bois", rsiPerMm: 0.0255, description: "Matelas de fibre de bois (différent des panneaux de carton-fibre)" },
    { id: "vermiculite", name: "Vermiculite", rsiPerMm: 0.0150, description: "Vermiculite" },
    { id: "perlite", name: "Perlite", rsiPerMm: 0.0230, description: "Perlite" }
  ],
  
  // Parements de bois
  woodCladding: [
    { id: "wood_shingle_190mm", name: "Bardeau de bois 400mm, pureau de 190mm", rsi: 0.15, description: "Bardeau de bois 400mm, pureau de 190mm" },
    { id: "wood_shingle_300mm", name: "Bardeau de bois 400mm, pureau double de 300mm", rsi: 0.21, description: "Bardeau de bois 400mm, pureau double de 300mm" },
    { id: "wood_siding_200mm_13mm", name: "Bardage de bois à clin 200mm, joints à recouvrement, épaisseur 13mm", rsi: 0.14, description: "Bardage de bois à clin 200mm, joints à recouvrement, épaisseur 13mm" },
    { id: "wood_siding_250mm_20mm", name: "Bardage de bois à clin 250mm, joints à recouvrement, épaisseur 20mm", rsi: 0.18, description: "Bardage de bois à clin 250mm, joints à recouvrement, épaisseur 20mm" },
    { id: "wood_siding_200mm_20mm", name: "Bardage à mi-bois, 200mm, épaisseur 20mm", rsi: 0.14, description: "Bardage à mi-bois, 200mm, épaisseur 20mm" },
    { id: "hardboard_11mm", name: "Panneaux de fibres dures, épaisseur 11mm", rsi: 0.12, description: "Panneaux de fibres dures, épaisseur 11mm (ex.: Canexel)" }
  ],

    // Autres parements
  otherCladding: [
    { id: "fibercement_6.35mm", name: "Panneaux de fibro-ciment, épaisseur 6.35mm", rsi: 0.003, description: "Panneaux de fibro-ciment, épaisseur 6.35mm" },
    { id: "fibercement_8mm", name: "Panneaux de fibro-ciment, épaisseur 8mm", rsi: 0.003, description: "Panneaux de fibro-ciment, épaisseur 8mm" }
  ],
  
// Maçonnerie (suite)
  masonry: [
    { id: "brick_90mm", name: "Brique d'argile ou schiste - 90mm", rsi: 0.07, description: "Brique d'argile ou schiste - 90mm (4''nominal, 2400 kg/m³)" },
    { id: "brick_concrete_90mm", name: "Brique de béton ou silico-calcaire - 90mm", rsi: 0.053, description: "Brique de béton ou silico-calcaire - 90mm (4'' nominal)" },
    { id: "stone_quartzite", name: "Quartzite et grès", rsiPerMm: 0.0003, description: "Quartzite et grès (2240 kg/m³)" },
    { id: "stone_calcite", name: "Calcite, dolomite, calcaire, marbre et granite", rsiPerMm: 0.0004, description: "Calcite, dolomite, calcaire, marbre et granite (2240 kg/m³)" }
  ],
  
  // Enduits
  plaster: [
    { id: "mortar", name: "Mortier, stucco, ciment, chaux", rsiPerMm: 0.0009, description: "Mortier, stucco, ciment, chaux" }
  ],
  
  // Bardage métallique et de vinyle
  metalVinylCladding: [
    { id: "vinyl_siding", name: "Planche à clin, sans endos", rsi: 0.11, description: "Planche à clin, sans endos" },
    { id: "vinyl_siding_insulated", name: "Planche à clin avec endos isolé, épaisseur 9,5mm", rsi: 0.32, description: "Planche à clin avec endos isolé, épaisseur 9,5mm" },
    { id: "vinyl_siding_insulated_foil", name: "Planche à clin avec endos isolé + pellicule aluminium, épaisseur 9,5mm", rsi: 0.52, description: "Planche à clin avec endos isolé + pellicule aluminium, épaisseur 9,5mm" }
  ],
  
  // Matériaux de toiture
  roofingMaterials: [
    { id: "roll_roofing", name: "Recouvrement de toiture enduit de bitume (en rouleau)", rsi: 0.03, description: "Recouvrement de toiture enduit de bitume (en rouleau)" },
    { id: "asphalt", name: "Bitume asphaltique", rsiPerMm: 0.0014, description: "Bitume asphaltique" },
    { id: "asphalt_shingles", name: "Bardeaux bitumés", rsi: 0.078, description: "Bardeaux bitumés" },
    { id: "built_up_roofing", name: "Couverture multicouche (5 plis) de 10mm d'épaisseur", rsi: 0.06, description: "Couverture multicouche (5 plis) de 10mm d'épaisseur" },
    { id: "wood_shingles_roof", name: "Bardeaux de bois", rsi: 0.17, description: "Bardeaux de bois" },
    { id: "crushed_stone", name: "Pierre concassée", rsiPerMm: 0.0006, description: "Pierre concassée" },
    { id: "steel_deck", name: "Platelage d'acier", rsi: 0, description: "Platelage d'acier - négligeable" },
    { id: "slate", name: "Ardoise, épaisseur 13mm", rsi: 0.01, description: "Ardoise, épaisseur 13mm" }
  ],
  
  // Matériaux de finition intérieure
  interiorFinish: [
    { id: "gypsum_interior", name: "Plaque de plâtre (gypse)", rsiPerMm: 0.0061, description: "Plaque de plâtre (panneaux de gypse)" },
    { id: "hardboard_interior", name: "Panneaux de fibres dures", rsiPerMm: 0.0095, description: "Panneaux de fibres dures (800 kg/m³)" },
    { id: "cement_interior", name: "Ciment, granulat de sable", rsiPerMm: 0.0014, description: "Ciment, granulat de sable" },
    { id: "plaster_sand", name: "Enduit au plâtre - agrégat de sable", rsiPerMm: 0.0012, description: "Enduit au plâtre - agrégat de sable" },
    { id: "plaster_light", name: "Enduit au plâtre - agrégat léger", rsiPerMm: 0.0044, description: "Enduit au plâtre - agrégat léger" },
    { id: "plywood_interior", name: "Contreplaqué", rsiPerMm: 0.0087, description: "Contreplaqué" },
    { id: "particleboard_590", name: "Panneaux de particules, faible masse volumique (590 kg/m³)", rsiPerMm: 0.0098, description: "Panneaux de particules, faible masse volumique (590 kg/m³)" },
    { id: "particleboard_800", name: "Panneaux de particules, faible masse volumique (800 kg/m³)", rsiPerMm: 0.0074, description: "Panneaux de particules, faible masse volumique (800 kg/m³)" },
    { id: "particleboard_1000", name: "Panneaux de particules, faible masse volumique (1000 kg/m³)", rsiPerMm: 0.0059, description: "Panneaux de particules, faible masse volumique (1000 kg/m³)" },
    { id: "carpet_fiber", name: "Moquette et thibaude fibreuse", rsi: 0.37, description: "Moquette et thibaude fibreuse" },
    { id: "carpet_rubber", name: "Moquette et thibaude caoutchoutée", rsi: 0.22, description: "Moquette et thibaude caoutchoutée" },
    { id: "cork_tile", name: "Carreaux de liège, épaisseur 3,2mm", rsi: 0.049, description: "Carreaux de liège, épaisseur 3,2mm" },
    { id: "terrazzo", name: "Terrazzo", rsiPerMm: 0.0006, description: "Terrazzo" },
    { id: "hardwood_floor", name: "Couvre-plancher en bois dur, épaisseur 19mm", rsi: 0.12, description: "Couvre-plancher en bois dur, épaisseur 19mm" },
    { id: "vinyl_floor", name: "Linoléum, vinyle, caoutchouc", rsi: 0.009, description: "Linoléum, vinyle, caoutchouc" }
  ]
};

// Tailles standard d'épaisseur en mm pour simplifier la sélection
const standardThicknesses = {
  wood: [19, 38, 64, 89, 140, 184, 235, 286],
  insulation: [25, 38, 50, 75, 89, 100, 140, 152, 175, 200, 240, 300],
  gypsum: [9.5, 12.7, 15.9],
  plywood: [6.0, 9.5, 12.5, 15.5, 18.5, 20.5, 22.5, 25.5],
  osb: [6.0, 9.5, 11, 15.5, 18.5],
  concrete: [50, 75, 100, 125, 150, 175, 200, 225, 250, 300],
  brick: [90, 100, 190, 200, 290],
  polystyrene: [13, 25, 38, 50, 76, 100],
  default: [10, 20, 30, 40, 50, 75, 100, 125, 150, 200]
};

// Fonction pour obtenir les épaisseurs standard en fonction du type de matériau
const getStandardThicknesses = (materialType) => {
  if (materialType.includes('wood') || materialType === 'structural') {
    return standardThicknesses.wood;
  } else if (materialType === 'insulation') {
    return standardThicknesses.insulation;
  } else if (materialType.includes('gypsum') || materialType.includes('interior')) {
    return standardThicknesses.gypsum;
  } else if (materialType.includes('plywood') || materialType.includes('sheathening')) {
    return standardThicknesses.plywood;
  } else if (materialType.includes('osb')) {
    return standardThicknesses.osb;
  } else if (materialType.includes('concrete')) {
    return standardThicknesses.concrete;
  } else if (materialType.includes('brick') || materialType.includes('masonry')) {
    return standardThicknesses.brick;
  } else if (materialType.includes('polystyrene')) {
    return standardThicknesses.polystyrene;
  } else {
    return standardThicknesses.default;
  }
};
        // Composant pour sélectionner un matériau avec épaisseur si nécessaire
const MaterialSelector = ({ 
  categoryOptions, 
  onChange, 
  value, 
  label, 
  showThickness = false,
  defaultThickness = 25,
  description = "",
  materialType = "default"
}) => {
  const [materialId, setMaterialId] = React.useState("");
  const [thickness, setThickness] = React.useState(defaultThickness);
  const [rsi, setRsi] = React.useState(null);
  const [customThickness, setCustomThickness] = React.useState(false);
  
  // Obtenir les épaisseurs standard pour ce type de matériau
  const standardThicknesses = getStandardThicknesses(materialType);
  
  React.useEffect(() => {
    if (!value) return;
    
    // Si value est un objet complet, on récupère les valeurs
    if (typeof value === 'object' && value !== null) {
      setMaterialId(value.id || "");
      setThickness(value.thickness || defaultThickness);
      setRsi(value.rsi || null);
      // Vérifier si l'épaisseur est personnalisée
      setCustomThickness(!standardThicknesses.includes(value.thickness));
    } else {
      // Sinon on considère que c'est juste l'id
      setMaterialId(value);
      
      // Trouver le matériau correspondant à l'id
      const allMaterials = categoryOptions.flatMap(category => category.materials);
      const material = allMaterials.find(m => m.id === value);
      
      if (material) {
        if (material.rsiPerMm) {
          // Pour les matériaux avec RSI par mm
          setRsi(material.rsiPerMm * thickness);
        } else {
          // Pour les matériaux avec RSI fixe
          setRsi(material.rsi);
        }
      }
    }
  }, [value, categoryOptions, defaultThickness, standardThicknesses]);
  
  const handleMaterialChange = (e) => {
    const id = e.target.value;
    setMaterialId(id);
    
    // Trouver le matériau correspondant à l'id
    const allMaterials = categoryOptions.flatMap(category => category.materials);
    const material = allMaterials.find(m => m.id === id);
    
    let newRsi = null;
    
    if (material) {
      if (material.rsiPerMm) {
        // Pour les matériaux avec RSI par mm
        newRsi = material.rsiPerMm * thickness;
      } else {
        // Pour les matériaux avec RSI fixe
        newRsi = material.rsi;
      }
      setRsi(newRsi);
    }
    
    onChange({
      id,
      thickness: thickness,
      rsi: newRsi,
      description: material ? material.description : ""
    });
  };

  const handleThicknessChange = (e) => {
    const newThickness = parseInt(e.target.value, 10) || 0;
    setThickness(newThickness);
    
    // Trouver le matériau correspondant à l'id
    const allMaterials = categoryOptions.flatMap(category => category.materials);
    const material = allMaterials.find(m => m.id === materialId);
    
    let newRsi = null;
    
    if (material && material.rsiPerMm) {
      newRsi = material.rsiPerMm * newThickness;
      setRsi(newRsi);
      
      onChange({
        id: materialId,
        thickness: newThickness,
        rsi: newRsi,
        description: material.description
      });
    }
  };

  const handleSelectThickness = (e) => {
    const newThickness = parseInt(e.target.value, 10);
    if (newThickness === -1) {
      // Option "Personnalisé" sélectionnée
      setCustomThickness(true);
    } else {
      setCustomThickness(false);
      setThickness(newThickness);
      
      // Mettre à jour le RSI si le matériau a une valeur par mm
      const allMaterials = categoryOptions.flatMap(category => category.materials);
      const material = allMaterials.find(m => m.id === materialId);
      
      if (material && material.rsiPerMm) {
        const newRsi = material.rsiPerMm * newThickness;
        setRsi(newRsi);
        
        onChange({
          id: materialId,
          thickness: newThickness,
          rsi: newRsi,
          description: material.description
        });
      }
    }
  };
  
  return (
    <div className="form-group">
      <label>{label}</label>
      <select 
        value={materialId} 
        onChange={handleMaterialChange} 
        className="w-full p-2 mb-2 border rounded"
      >
        <option value="">Sélectionnez un matériau</option>
        {categoryOptions.map(category => (
          <optgroup key={category.name} label={category.name}>
            {category.materials.map(material => (
              <option key={material.id} value={material.id}>{material.name}</option>
            ))}
          </optgroup>
        ))}
      </select>
      
      {materialId && showThickness && (
        <div className="mt-2">
          <label>Épaisseur:</label>
          <select 
            value={customThickness ? -1 : thickness} 
            onChange={handleSelectThickness}
            className="w-full p-2 mb-2 border rounded"
          >
            {standardThicknesses.map(t => (
              <option key={t} value={t}>{t} mm</option>
            ))}
            <option value={-1}>Personnalisé</option>
          </select>
          
          {customThickness && (
            <input 
              type="number" 
              value={thickness} 
              onChange={handleThicknessChange} 
              min="1" 
              className="w-full p-2 border rounded mb-2"
              placeholder="Épaisseur en mm"
            />
          )}
        </div>
      )}
      
      {rsi !== null && (
        <div className="mt-2 text-sm">
          <div><strong>Résistance thermique:</strong> {formatRSIR(rsi)}</div>
          {description && <div className="text-gray-600">{description}</div>}
        </div>
      )}
    </div>
  );
};

// Composant d'accordéon pour les sections
const Accordion = ({ title, children, defaultOpen = false }) => {
  const [isOpen, setIsOpen] = React.useState(defaultOpen);
  
  return (
    <div className="border rounded mb-4 overflow-hidden">
      <div 
        className="p-3 bg-gray-100 flex justify-between items-center cursor-pointer"
        onClick={() => setIsOpen(!isOpen)}
      >
        <h3 className="font-bold">{title}</h3>
        {isOpen ? (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="feather feather-chevron-up"><polyline points="18 15 12 9 6 15"></polyline></svg>
        ) : (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
        )}
      </div>
      {isOpen && (
        <div className="p-4 border-t">
          {children}
        </div>
      )}
    </div>
  );
};

// Composant pour afficher le graphique de gradient de température
const TemperatureGradientChart = ({ layers, exteriorTemp, interiorTemp }) => {
  const chartRef = React.useRef(null);
  const chartInstance = React.useRef(null);
  
  React.useEffect(() => {
    if (!layers || layers.length === 0) return;
    
    // Calculer la résistance thermique totale et les positions des matériaux
    const totalRSI = layers.reduce((total, layer) => {
      if (layer.material && layer.material.rsi !== undefined && layer.material.rsi !== null) {
        return total + layer.material.rsi;
      }
      return total;
    }, 0);
    
    // Calculer la différence de température totale
    const totalDeltaT = interiorTemp - exteriorTemp;
    
    // Positions sur l'axe X pour chaque couche (en pourcentage de la largeur totale)
    let positions = [];
    let temps = [];
    let cumRSI = 0;
    
    // Position de départ = température extérieure
    positions.push(0);
    temps.push(exteriorTemp);
    
    // Calculer les positions et températures pour chaque couche
    layers.forEach((layer, index) => {
      if (layer.material && layer.material.rsi) {
        // Calculer la part de résistance thermique de cette couche
        const layerRSI = layer.material.rsi;
        const proportion = layerRSI / totalRSI;
        
        // Calculer la chute de température dans cette couche
        const deltaT = proportion * totalDeltaT;
        
        // Mise à jour de la résistance thermique cumulée
        cumRSI += layerRSI;
        
        // Position relative (en pourcentage)
        const position = (index + 1) / (layers.length + 1);
        positions.push(position);
        
        // Température à cette position
        const temp = exteriorTemp + (cumRSI / totalRSI) * totalDeltaT;
        temps.push(temp);
      }
    });
    
    // Position finale = température intérieure
    positions.push(1);
    temps.push(interiorTemp);
    
    // Générer des données pour 3 scénarios de température
    const tempScenarios = [
      {
        label: `Ext: ${exteriorTemp}°C / Int: ${interiorTemp}°C`,
        data: temps,
        borderColor: 'rgba(75, 192, 192, 1)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        tension: 0.1
      },
      {
        label: `Ext: ${exteriorTemp - 10}°C / Int: ${interiorTemp}°C`,
        data: temps.map((t, i) => {
          if (i === 0) return exteriorTemp - 10;
          if (i === temps.length - 1) return interiorTemp;
          const proportion = cumRSI / totalRSI;
          return interiorTemp - ((interiorTemp - (exteriorTemp - 10)) * (1 - (proportion * i / (temps.length - 1))));
        }),
        borderColor: 'rgba(54, 162, 235, 1)',
        backgroundColor: 'rgba(54, 162, 235, 0.2)',
        tension: 0.1
      },
      {
        label: `Ext: ${exteriorTemp + 10}°C / Int: ${interiorTemp}°C`,
        data: temps.map((t, i) => {
          if (i === 0) return exteriorTemp + 10;
          if (i === temps.length - 1) return interiorTemp;
          const proportion = cumRSI / totalRSI;
          return interiorTemp - ((interiorTemp - (exteriorTemp + 10)) * (1 - (proportion * i / (temps.length - 1))));
        }),
        borderColor: 'rgba(255, 99, 132, 1)',
        backgroundColor: 'rgba(255, 99, 132, 0.2)',
        tension: 0.1
      }
    ];
    
    // Labels pour l'axe X (noms des matériaux)
    const labels = ["Extérieur", ...layers.map(layer => 
      layer.material ? layer.material.description.split(' ')[0] : "Couche"
    ), "Intérieur"];
    
    // Création/mise à jour du graphique
    if (chartInstance.current) {
      chartInstance.current.destroy();
    }
    
    const ctx = chartRef.current.getContext('2d');
    chartInstance.current = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: tempScenarios
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Gradient de température à travers l\'enveloppe'
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            callbacks: {
              label: function(context) {
                return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}°C`;
              }
            }
          }
        },
        scales: {
          y: {
            title: {
              display: true,
              text: 'Température (°C)'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Composants de l\'enveloppe'
            }
          }
        }
      }
    });
    
    return () => {
      if (chartInstance.current) {
        chartInstance.current.destroy();
      }
    };
  }, [layers, exteriorTemp, interiorTemp]);
  
  return (
    <div className="mt-4">
      <canvas ref={chartRef}></canvas>
    </div>
  );
};
        // Composant principal du calculateur
const Calculator = () => {
  // État pour les données générales
  const [location, setLocation] = React.useState("");
  const [degreeDays, setDegreeDays] = React.useState("");
  const [climaticZone, setClimaticZone] = React.useState("");
  const [buildingType, setBuildingType] = React.useState("residential");
  const [envelopeComponent, setEnvelopeComponent] = React.useState("wall_above_grade");
  
  // États pour les paramètres de température
  const [exteriorTemp, setExteriorTemp] = React.useState(-26);
  const [interiorTemp, setInteriorTemp] = React.useState(21);
  const [interiorHumidity, setInteriorHumidity] = React.useState(50);
  
  // États pour les composants de l'enveloppe
  const [layers, setLayers] = React.useState([]);
  const [results, setResults] = React.useState(null);
  
  // Mise à jour des degrés-jours en fonction de la municipalité
  React.useEffect(() => {
    if (location) {
      const municipality = municipalities.find(m => m.id === location);
      if (municipality) {
        setDegreeDays(municipality.degreeDay);
        setClimaticZone(municipality.zone);
      }
    }
  }, [location]);
  
  // Fonction pour ajouter une couche de matériau
  const addLayer = (type) => {
    setLayers([...layers, { id: Date.now(), type, material: null }]);
  };
  
  // Fonction pour supprimer une couche
  const removeLayer = (id) => {
    setLayers(layers.filter(layer => layer.id !== id));
  };
  
  // Fonction pour mettre à jour une couche
  const updateLayer = (id, material) => {
    setLayers(layers.map(layer => 
      layer.id === id ? { ...layer, material } : layer
    ));
  };
  
  // Fonction pour déplacer une couche vers le haut
  const moveLayerUp = (id) => {
    const index = layers.findIndex(layer => layer.id === id);
    if (index > 0) {
      const newLayers = [...layers];
      [newLayers[index - 1], newLayers[index]] = [newLayers[index], newLayers[index - 1]];
      setLayers(newLayers);
    }
  };
  
  // Fonction pour déplacer une couche vers le bas
  const moveLayerDown = (id) => {
    const index = layers.findIndex(layer => layer.id === id);
    if (index < layers.length - 1) {
      const newLayers = [...layers];
      [newLayers[index], newLayers[index + 1]] = [newLayers[index + 1], newLayers[index]];
      setLayers(newLayers);
    }
  };
  
  // Fonction pour calculer la résistance thermique totale (RSI_T)
  const calculateTotalRSI = () => {
    return layers.reduce((total, layer) => {
      if (layer.material && layer.material.rsi !== undefined && layer.material.rsi !== null) {
        return total + layer.material.rsi;
      }
      return total;
    }, 0);
  };
  
  // Fonction pour calculer la résistance thermique effective (RSI_E)
  const calculateEffectiveRSI = (totalRSI) => {
    // Dans une application réelle, ce calcul serait plus complexe et dépendrait du type de construction
    // Utilisation d'une estimation plus précise que simple facteur 0.85
    
    // Part de l'ossature (en %)
    const framingRatio = 0.23; // Par exemple, pour des montants à 406mm c/c
    
    // On suppose que l'isolation remplit les cavités entre les montants
    // Résistance thermique des montants (approximation)
    const framingRSI = totalRSI * 0.6; // Les montants ont environ 60% de la résistance thermique totale
    
    // Calcul selon la méthode présentée dans la fiche technique
    const effectiveRSI = 1 / ((framingRatio / framingRSI) + ((1 - framingRatio) / totalRSI));
    
    return effectiveRSI;
  };
  
  // Fonction pour calculer les gradients de température à travers l'enveloppe
  const calculateTemperatureGradients = () => {
    if (layers.length === 0) return null;
    
    const totalRSI = calculateTotalRSI();
    const deltaT = interiorTemp - exteriorTemp;
    
    let cumulativeRSI = 0;
    const gradients = [];
    
    // Commencer par l'extérieur
    gradients.push({
      position: 0,
      temperature: exteriorTemp
    });
    
    // Calculer la température à chaque interface
    for (let i = 0; i < layers.length; i++) {
      if (layers[i].material && layers[i].material.rsi) {
        const layerRSI = layers[i].material.rsi;
        cumulativeRSI += layerRSI;
        
        const temperature = exteriorTemp + (cumulativeRSI / totalRSI) * deltaT;
        gradients.push({
          position: (i + 1) / (layers.length + 1),
          temperature
        });
      }
    }
    
// Finir par l'intérieur
    gradients.push({
      position: 1,
      temperature: interiorTemp
    });
    
    return gradients;
  };
  
  // Fonction pour calculer le point de rosée
  const calculateDewPoint = () => {
    // Formule de Magnus-Tetens
    const a = 17.27;
    const b = 237.7;
    
    const alpha = ((a * interiorTemp) / (b + interiorTemp)) + Math.log(interiorHumidity / 100);
    const dewPoint = (b * alpha) / (a - alpha);
    
    return dewPoint;
  };
  
  // Fonction pour vérifier la conformité au code
  const checkCompliance = (rsi, component, zone) => {
    if (!zone || !component) return { compliant: false, minRSI: 0 };
    
    const minRSI = minRSIValues[zone][component] || 0;
    return {
      compliant: rsi >= minRSI,
      minRSI
    };
  };
  
  // Fonction pour calculer les résultats complets
  const calculateResults = () => {
    const totalRSI = calculateTotalRSI();
    const effectiveRSI = calculateEffectiveRSI(totalRSI);
    
    const totalCompliance = checkCompliance(totalRSI, envelopeComponent, climaticZone);
    const effectiveCompliance = checkCompliance(effectiveRSI, envelopeComponent, climaticZone);
    
    const temperatureGradients = calculateTemperatureGradients();
    const dewPoint = calculateDewPoint();
    
    // Déterminer si le point de rosée se situe à l'intérieur de l'enveloppe
    let condensationRisk = false;
    let condensationLayer = null;
    
    if (temperatureGradients && temperatureGradients.length > 0) {
      // Parcourir les gradients de température
      for (let i = 0; i < temperatureGradients.length - 1; i++) {
        const currentTemp = temperatureGradients[i].temperature;
        const nextTemp = temperatureGradients[i + 1].temperature;
        
        // Si la température à ce point est inférieure au point de rosée
        if (currentTemp <= dewPoint && nextTemp >= dewPoint) {
          condensationRisk = true;
          condensationLayer = i;
          break;
        }
      }
    }
    
    setResults({
      totalRSI,
      effectiveRSI,
      totalCompliance,
      effectiveCompliance,
      temperatureGradients,
      dewPoint,
      condensationRisk,
      condensationLayer
    });
  };

  // Préparation des options de matériaux pour les sélecteurs
  const prepareMaterialOptions = (materialCategories) => {
    return Object.entries(materialCategories).map(([key, value]) => ({
      name: key,
      materials: value
    }));
  };
  
  const airFilmOptions = [
    { name: "Films d'air", materials: materials.airFilms }
  ];
  
  const airSpaceOptions = [
    { name: "Lames d'air non réfléchissantes", materials: materials.airSpaces },
    { name: "Lames d'air réfléchissantes", materials: materials.reflectiveAirSpaces }
  ];
  
  const insulationOptions = prepareMaterialOptions({
    "Isolants en fibre": materials.insulation.filter(m => 
      m.name.toLowerCase().includes("fibre") || 
      m.name.toLowerCase().includes("laine")
    ),
    "Isolants synthétiques": materials.insulation.filter(m => 
      m.name.toLowerCase().includes("polystyrène") || 
      m.name.toLowerCase().includes("polyurethane") ||
      m.name.toLowerCase().includes("polyiso")
    ),
    "Autres isolants": materials.insulation.filter(m => 
      !m.name.toLowerCase().includes("fibre") && 
      !m.name.toLowerCase().includes("laine") &&
      !m.name.toLowerCase().includes("polystyrène") &&
      !m.name.toLowerCase().includes("polyurethane") &&
      !m.name.toLowerCase().includes("polyiso")
    )
  });
  
  const sheatheningOptions = [
    { name: "Revêtements d'ossature", materials: materials.sheathing }
  ];
  
  const exteriorCladdingOptions = prepareMaterialOptions({
    "Parements de bois": materials.woodCladding,
    "Bardage métallique et vinyle": materials.metalVinylCladding,
    "Maçonnerie": materials.masonry,
    "Autres parements": materials.otherCladding
  });
  
  const interiorFinishOptions = [
    { name: "Finitions intérieures", materials: materials.interiorFinish }
  ];
  
  const structuralOptions = prepareMaterialOptions({
    "Bois": materials.wood,
    "Béton": materials.concrete,
    "Blocs de béton": materials.concreteBlocks
  });

  // Fonction pour créer une configuration par défaut en fonction du type d'enveloppe sélectionné
  const createDefaultConfiguration = () => {
    let defaultLayers = [];
    
    switch (envelopeComponent) {
      case "wall_above_grade": // Mur hors sol
        defaultLayers = [
          { id: Date.now(), type: 'airfilm', material: { id: 'exterior', rsi: 0.03, description: "Pellicule d'air de surface (vent hivernal de 24 Km/h)" } },
          { id: Date.now() + 1, type: 'cladding', material: { id: 'brick_90mm', rsi: 0.07, thickness: 90, description: "Brique d'argile ou schiste - 90mm (4''nominal, 2400 kg/m³)" } },
          { id: Date.now() + 2, type: 'airspace', material: { id: 'airspace_wall_20mm', rsi: 0.18, description: "Lame d'air dans un mur - 20mm+" } },
          { id: Date.now() + 3, type: 'sheathening', material: { id: 'osb', rsi: 0.11, thickness: 11, description: "Panneaux de copeaux (OSB)" } },
          { id: Date.now() + 4, type: 'insulation', material: { id: 'mineral_wool', rsi: 3.875, thickness: 140, description: "Laine de roche (Roxul Cavity Rock)" } },
          { id: Date.now() + 5, type: 'airspace', material: { id: 'airspace_wall_20mm', rsi: 0.18, description: "Lame d'air dans un mur - 20mm+" } },
          { id: Date.now() + 6, type: 'interior', material: { id: 'gypsum_interior', rsi: 0.077, thickness: 12.7, description: "Plaque de plâtre (gypse)" } },
          { id: Date.now() + 7, type: 'airfilm', material: { id: 'interior_vertical', rsi: 0.12, description: "Air stable, surface verticale, flux thermique horizontal" } }
        ];
        break;
        
      case "roof": // Toit
        defaultLayers = [
          { id: Date.now(), type: 'airfilm', material: { id: 'exterior', rsi: 0.03, description: "Pellicule d'air de surface (vent hivernal de 24 Km/h)" } },
          { id: Date.now() + 1, type: 'cladding', material: { id: 'asphalt_shingles', rsi: 0.078, description: "Bardeaux bitumés" } },
          { id: Date.now() + 2, type: 'sheathening', material: { id: 'plywood', rsi: 0.109, thickness: 12.5, description: "Contreplaqué de bois tendre" } },
          { id: Date.now() + 3, type: 'airspace', material: { id: 'airspace_ceiling_90mm', rsi: 0.16, description: "Lame d'air dans un plafond - 90mm+" } },
          { id: Date.now() + 4, type: 'insulation', material: { id: 'mineral_blown', rsi: 5.25, thickness: 350, description: "Fibre minérale épandue (combles)" } },
          { id: Date.now() + 5, type: 'interior', material: { id: 'gypsum_interior', rsi: 0.077, thickness: 12.7, description: "Plaque de plâtre (gypse)" } },
          { id: Date.now() + 6, type: 'airfilm', material: { id: 'interior_ceiling', rsi: 0.11, description: "Air stable, surface horizontale, flux thermique ascendant" } }
        ];
        break;
        
      case "foundation_wall": // Mur de fondation
        defaultLayers = [
          { id: Date.now(), type: 'structural', material: { id: 'concrete_2400', rsi: 0.08, thickness: 200, description: "Béton 2400 kg/m³" } },
          { id: Date.now() + 1, type: 'insulation', material: { id: 'extruded_polystyrene', rsi: 1.54, thickness: 60, description: "Polystyrène extrudé" } },
          { id: Date.now() + 2, type: 'airspace', material: { id: 'airspace_wall_20mm', rsi: 0.18, description: "Lame d'air dans un mur - 20mm+" } },
          { id: Date.now() + 3, type: 'interior', material: { id: 'gypsum_interior', rsi: 0.077, thickness: 12.7, description: "Plaque de plâtre (gypse)" } },
          { id: Date.now() + 4, type: 'airfilm', material: { id: 'interior_vertical', rsi: 0.12, description: "Air stable, surface verticale, flux thermique horizontal" } }
        ];
        break;
        
      case "floor": // Plancher
        defaultLayers = [
          { id: Date.now(), type: 'airfilm', material: { id: 'exterior', rsi: 0.03, description: "Pellicule d'air de surface (vent hivernal de 24 Km/h)" } },
          { id: Date.now() + 1, type: 'sheathening', material: { id: 'plywood', rsi: 0.109, thickness: 12.5, description: "Contreplaqué de bois tendre" } },
          { id: Date.now() + 2, type: 'insulation', material: { id: 'mineral_wool', rsi: 3.875, thickness: 140, description: "Laine de roche (Roxul Cavity Rock)" } },
          { id: Date.now() + 3, type: 'structural', material: { id: 'wood_spf', rsi: 0.756, thickness: 89, description: "Bois de construction courant (S-P-F)" } },
          { id: Date.now() + 4, type: 'interior', material: { id: 'hardwood_floor', rsi: 0.12, description: "Couvre-plancher en bois dur, épaisseur 19mm" } },
          { id: Date.now() + 5, type: 'airfilm', material: { id: 'interior_floor', rsi: 0.16, description: "Air stable, surface horizontale, flux thermique descendant" } }
        ];
        break;
        
      default:
        defaultLayers = [];
    }
    
    setLayers(defaultLayers);
  };

  return (
    <div className="max-w-6xl mx-auto p-4">
      <h1 className="text-3xl font-bold mb-6 text-center">Calculateur de Résistance Thermique</h1>
      <p className="mb-6 text-center">
        Calculez la résistance thermique totale (RSI<sub>T</sub>) et effective (RSI<sub>E</sub>) de l'enveloppe du bâtiment 
        selon les exigences du Code de construction du Québec.
      </p>
      
      <Accordion title="Données générales du bâtiment" defaultOpen={true}>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div className="form-group">
            <label>Municipalité:</label>
            <select 
              value={location} 
              onChange={(e) => setLocation(e.target.value)}
              className="w-full p-2 border rounded"
            >
              <option value="">Sélectionnez une municipalité</option>
              {municipalities.map(municipality => (
                <option key={municipality.id} value={municipality.id}>
                  {municipality.name} ({municipality.degreeDay} degrés-jours)
                </option>
              ))}
            </select>
          </div>
          
          <div className="form-group">
            <label>Degrés-jours sous 18°C:</label>
            <input 
              type="number" 
              value={degreeDays} 
              onChange={(e) => setDegreeDays(e.target.value)}
              className="w-full p-2 border rounded"
              placeholder="Ex: 4500"
            />
            {climaticZone && (
              <div className="mt-1 text-sm">
                Zone climatique: {climaticZone === "< 6000" ? "Moins de 6000 degrés-jours" : "6000 degrés-jours ou plus"}
              </div>
            )}
          </div>
          
          <div className="form-group">
            <label>Type de bâtiment:</label>
            <select 
              value={buildingType} 
              onChange={(e) => setBuildingType(e.target.value)}
              className="w-full p-2 border rounded"
            >
              <option value="residential">Habitation résidentielle</option>
              <option value="commercial">Bâtiment commercial</option>
              <option value="industrial">Bâtiment industriel</option>
            </select>
          </div>
          
          <div className="form-group">
            <label>Composante de l'enveloppe à analyser:</label>
            <select 
              value={envelopeComponent} 
              onChange={(e) => setEnvelopeComponent(e.target.value)}
              className="w-full p-2 border rounded"
            >
              <option value="wall_above_grade">Mur hors sol</option>
              <option value="foundation_wall">Mur de fondation</option>
              <option value="roof">Toit ou plafond</option>
              <option value="floor">Plancher séparant un espace chauffé d'un espace non chauffé</option>
              <option value="garage_ceiling">Plafond de garage chauffé</option>
              <option value="garage_walls">Murs de garage chauffé</option>
            </select>
          </div>
        </div>
        
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 pt-4 border-t">
          <div className="form-group">
            <label>Température extérieure (°C):</label>
            <input 
              type="number" 
              value={exteriorTemp} 
              onChange={(e) => setExteriorTemp(parseFloat(e.target.value))}
              className="w-full p-2 border rounded"
            />
          </div>
          
          <div className="form-group">
            <label>Température intérieure (°C):</label>
            <input 
              type="number" 
              value={interiorTemp} 
              onChange={(e) => setInteriorTemp(parseFloat(e.target.value))}
              className="w-full p-2 border rounded"
            />
          </div>
          
          <div className="form-group">
            <label>Humidité relative intérieure (%):</label>
            <input 
              type="number" 
              min="0"
              max="100"
              value={interiorHumidity} 
              onChange={(e) => setInteriorHumidity(parseInt(e.target.value, 10))}
              className="w-full p-2 border rounded"
            />
          </div>
        </div>
        
        <div className="mt-4">
          <button 
            onClick={createDefaultConfiguration}
            className="bg-blue-500 text-white px-4 py-2 rounded"
          >
            Créer une configuration par défaut
          </button>
        </div>
      </Accordion>
      
      <Accordion title="Composition de l'enveloppe" defaultOpen={true}>
        <div className="mb-4">
          <p className="mb-2">Ajoutez des couches du <strong>côté extérieur</strong> vers le <strong>côté intérieur</strong> :</p>
          <div className="flex flex-wrap gap-2">
            <button 
              onClick={() => addLayer('airfilm')} 
              className="bg-blue-500 text-white px-3 py-1 rounded"
            >
              + Film d'air
            </button>
            <button 
              onClick={() => addLayer('airspace')} 
              className="bg-blue-500 text-white px-3 py-1 rounded"
            >
              + Lame d'air
            </button>
            <button 
              onClick={() => addLayer('insulation')} 
              className="bg-blue-500 text-white px-3 py-1 rounded"
            >
              + Isolant
            </button>
            <button 
              onClick={() => addLayer('sheathening')} 
              className="bg-blue-500 text-white px-3 py-1 rounded"
            >
              + Revêtement intermédiaire
            </button>
            <button 
              onClick={() => addLayer('cladding')} 
              className="bg-blue-500 text-white px-3 py-1 rounded"
            >
              + Parement extérieur
            </button>
            <button 
              onClick={() => addLayer('interior')} 
              className="bg-blue-500 text-white px-3 py-1 rounded"
            >
              + Finition intérieure
            </button>
            <button 
              onClick={() => addLayer('structural')} 
              className="bg-blue-500 text-white px-3 py-1 rounded"
            >
              + Élément structural
            </button>
          </div>
        </div>

        {layers.length === 0 && (
          <div className="p-4 border rounded bg-gray-50 text-center">
            Ajoutez des couches de matériaux pour commencer l'analyse
          </div>
        )}
        
        <div className="space-y-2">
          {layers.map((layer, index) => (
            <div key={layer.id} className="border p-4 rounded bg-gray-50">
              <div className="flex justify-between items-start mb-2">
                <div className="flex items-center">
                  <span className="inline-block w-6 text-center mr-2">{index + 1}.</span>
                  <h4 className="font-bold">
                    {layer.type === 'airfilm' ? 'Film d\'air' : 
                     layer.type === 'airspace' ? 'Lame d\'air' : 
                     layer.type === 'insulation' ? 'Isolant' : 
                     layer.type === 'sheathening' ? 'Revêtement intermédiaire' : 
                     layer.type === 'cladding' ? 'Parement extérieur' : 
                     layer.type === 'interior' ? 'Finition intérieure' : 'Élément structural'}
                  </h4>
                </div>
                <div className="flex space-x-2">
                  <button 
                    onClick={() => moveLayerUp(layer.id)} 
                    className="text-blue-600 hover:text-blue-800"
                    disabled={index === 0}
                    title="Déplacer vers le haut"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
                  </button>
                  <button 
                    onClick={() => moveLayerDown(layer.id)} 
                    className="text-blue-600 hover:text-blue-800"
                    disabled={index === layers.length - 1}
                    title="Déplacer vers le bas"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                  </button>
                  <button 
                    onClick={() => removeLayer(layer.id)} 
                    className="text-red-600 hover:text-red-800"
                    title="Supprimer"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                  </button>
                </div>
              </div>
              
              {layer.type === 'airfilm' && (
                <MaterialSelector
                  categoryOptions={airFilmOptions}
                  value={layer.material}
                  onChange={(material) => updateLayer(layer.id, material)}
                  label="Sélectionnez un film d'air:"
                  materialType="airfilm"
                />
              )}
              
              {layer.type === 'airspace' && (
                <MaterialSelector
                  categoryOptions={airSpaceOptions}
                  value={layer.material}
                  onChange={(material) => updateLayer(layer.id, material)}
                  label="Sélectionnez une lame d'air:"
                  materialType="airspace"
                />
              )}
              
              {layer.type === 'insulation' && (
                <MaterialSelector
                  categoryOptions={insulationOptions}
                  value={layer.material}
                  onChange={(material) => updateLayer(layer.id, material)}
                  label="Sélectionnez un isolant:"
                  showThickness={true}
                  defaultThickness={89}
                  materialType="insulation"
                />
              )}
              
              {layer.type === 'sheathening' && (
                <MaterialSelector
                  categoryOptions={sheatheningOptions}
                  value={layer.material}
                  onChange={(material) => updateLayer(layer.id, material)}
                  label="Sélectionnez un revêtement intermédiaire:"
                  showThickness={true}
                  defaultThickness={11}
                  materialType="sheathening"
                />
              )}
              
              {layer.type === 'cladding' && (
                <MaterialSelector
                  categoryOptions={exteriorCladdingOptions}
                  value={layer.material}
                  onChange={(material) => updateLayer(layer.id, material)}
                  label="Sélectionnez un parement extérieur:"
                  showThickness={true}
                  defaultThickness={20}
                  materialType="cladding"
                />
              )}
              
              {layer.type === 'interior' && (
                <MaterialSelector
                  categoryOptions={interiorFinishOptions}
                  value={layer.material}
                  onChange={(material) => updateLayer(layer.id, material)}
                  label="Sélectionnez une finition intérieure:"
                  showThickness={true}
                  defaultThickness={13}
                  materialType="interior"
                />
              )}
              
              {layer.type === 'structural' && (
                <MaterialSelector
                  categoryOptions={structuralOptions}
                  value={layer.material}
                  onChange={(material) => updateLayer(layer.id, material)}
                  label="Sélectionnez un élément structural:"
                  showThickness={true}
                  defaultThickness={89}
                  materialType="structural"
                />
              )}
            </div>
          ))}
        </div>
        
        <button 
          onClick={calculateResults}
          className="w-full mt-4 bg-green-600 text-white py-2 rounded font-bold"
          disabled={layers.length === 0}
        >
          Calculer la performance thermique
        </button>
      </Accordion>
      
      {results && (
        <div className="mt-6 border rounded p-6 bg-gray-50">
          <h2 className="text-2xl font-bold mb-4">Résultats d'analyse</h2>
          
          <div className="mb-6">
            <p className="mb-2">
              Selon les données fournies, votre composition d'enveloppe atteint:
            </p>
            <ul className="list-disc pl-6 mb-4">
              <li className="mb-1">
                <strong>Résistance thermique totale (RSI<sub>T</sub>):</strong> {formatRSIR(results.totalRSI)}
              </li>
              <li>
                <strong>Résistance thermique effective (RSI<sub>E</sub>):</strong> {formatRSIR(results.effectiveRSI)}
              </li>
            </ul>
            
            <p className="mb-2">
              Exigences minimales selon le Code pour {envelopeComponent === 'wall_above_grade' ? 'un mur hors sol' : 
                                                     envelopeComponent === 'foundation_wall' ? 'un mur de fondation' :
                                                     envelopeComponent === 'roof' ? 'un toit ou plafond' :
                                                     envelopeComponent === 'floor' ? 'un plancher séparant un espace chauffé d\'un espace non chauffé' :
                                                     envelopeComponent === 'garage_ceiling' ? 'un plafond de garage chauffé' : 'des murs de garage chauffé'} 
              dans votre zone climatique ({climaticZone}):
            </p>
            <ul className="list-disc pl-6">
              <li className="mb-1">
                <strong>Résistance thermique totale minimale (RSI<sub>T</sub>):</strong> {formatRSIR(results.totalCompliance.minRSI)}
              </li>
              <li className="mb-4">
                <strong>Résistance thermique effective minimale (RSI<sub>E</sub>):</strong> {formatRSIR(results.effectiveCompliance.minRSI)}
              </li>
            </ul>
            
            <div className={`p-4 rounded ${results.totalCompliance.compliant ? 'bg-green-100 border border-green-300' : 'bg-red-100 border border-red-300'}`}>
              <p className={`font-bold ${results.totalCompliance.compliant ? 'text-green-800' : 'text-red-800'}`}>
                {results.totalCompliance.compliant ? 
                  '✓ Cette composition est conforme aux exigences du Code de construction du Québec' : 
                  '✗ Cette composition n\'est PAS conforme aux exigences du Code de construction du Québec'}
              </p>
              {!results.totalCompliance.compliant && (
                <p className="mt-2 text-red-800">
                  Pour atteindre la conformité, vous devez augmenter la résistance thermique totale d'au moins {(results.totalCompliance.minRSI - results.totalRSI).toFixed(2)} RSI.
                </p>
              )}
            </div>
          </div>
          
          <div className="mb-6">
            <h3 className="text-xl font-bold mb-3">Analyse du point de rosée</h3>
            <p className="mb-2">
              Pour les conditions intérieures de {interiorTemp}°C et {interiorHumidity}% d'humidité relative:
            </p>
            <ul className="list-disc pl-6 mb-4">
              <li className="mb-1">
                <strong>Point de rosée:</strong> {results.dewPoint.toFixed(1)}°C
              </li>
            </ul>
            
            {results.condensationRisk && (
              <div className="p-4 bg-yellow-100 border border-yellow-300 rounded mb-4">
                <p className="font-bold text-yellow-800">
                  ⚠️ Risque de condensation détecté!
                </p>
                <p className="mt-2 text-yellow-800">
                  Dans ces conditions, la condensation pourrait se produire au niveau de la couche {results.condensationLayer + 1} ({layers[results.condensationLayer]?.material?.description || 'inconnue'}).
                </p>
                <p className="mt-2 text-yellow-800">
                  Pour éviter ce problème, envisagez d'augmenter l'isolation du côté extérieur de cette couche ou d'améliorer la ventilation pour réduire l'humidité intérieure.
                </p>
              </div>
            )}
            
            <h4 className="font-bold mb-2">Gradient de température à travers l'enveloppe:</h4>
            <TemperatureGradientChart 
              layers={layers} 
              exteriorTemp={exteriorTemp} 
              interiorTemp={interiorTemp} 
            />
          </div>
          
<h3 className="text-xl font-bold mb-3">Résistance thermique par couche</h3>
          <div className="overflow-x-auto">
            <table className="w-full border-collapse">
              <thead>
                <tr className="bg-gray-200">
                  <th className="border px-4 py-2 text-left">Couche</th>
                  <th className="border px-4 py-2 text-left">Matériau</th>
                  <th className="border px-4 py-2 text-left">Épaisseur (mm)</th>
                  <th className="border px-4 py-2 text-left">RSI (m²·K/W)</th>
                  <th className="border px-4 py-2 text-left">R (pi²·°F·h/BTU)</th>
                </tr>
              </thead>
              <tbody>
                {layers.map((layer, index) => (
                  <tr key={layer.id}>
                    <td className="border px-4 py-2">{index + 1}. {layer.type === 'airfilm' ? 'Film d\'air' : 
                                                 layer.type === 'airspace' ? 'Lame d\'air' : 
                                                 layer.type === 'insulation' ? 'Isolant' : 
                                                 layer.type === 'sheathening' ? 'Revêtement intermédiaire' : 
                                                 layer.type === 'cladding' ? 'Parement extérieur' : 
                                                 layer.type === 'interior' ? 'Finition intérieure' : 'Élément structural'}</td>
                    <td className="border px-4 py-2">{layer.material ? layer.material.description || "—" : "—"}</td>
                    <td className="border px-4 py-2">{layer.material && layer.material.thickness ? layer.material.thickness : "—"}</td>
                    <td className="border px-4 py-2">{layer.material ? layer.material.rsi.toFixed(3) : "—"}</td>
                    <td className="border px-4 py-2">{layer.material ? (layer.material.rsi * 5.678263).toFixed(3) : "—"}</td>
                  </tr>
                ))}
                <tr className="font-bold bg-gray-100">
                  <td className="border px-4 py-2" colSpan="3">Total</td>
                  <td className="border px-4 py-2">{results.totalRSI.toFixed(3)}</td>
                  <td className="border px-4 py-2">{(results.totalRSI * 5.678263).toFixed(3)}</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <h3 className="text-xl font-bold my-3">Résumé de conformité</h3>
          <div className="overflow-x-auto">
            <table className="w-full border-collapse">
              <thead>
                <tr className="bg-gray-200">
                  <th className="border px-4 py-2 text-left">Mesure</th>
                  <th className="border px-4 py-2 text-left">Valeur</th>
                  <th className="border px-4 py-2 text-left">Exigence minimale</th>
                  <th className="border px-4 py-2 text-left">Conformité</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td className="border px-4 py-2">Résistance thermique totale (RSI<sub>T</sub>)</td>
                  <td className="border px-4 py-2">{formatRSIR(results.totalRSI)}</td>
                  <td className="border px-4 py-2">{formatRSIR(results.totalCompliance.minRSI)}</td>
                  <td className="border px-4 py-2">
                    {results.totalCompliance.compliant ? 
                      <span className="text-green-600 font-bold">Conforme ✓</span> : 
                      <span className="text-red-600 font-bold">Non conforme ✗</span>}
                  </td>
                </tr>
                <tr>
                  <td className="border px-4 py-2">Résistance thermique effective (RSI<sub>E</sub>)</td>
                  <td className="border px-4 py-2">{formatRSIR(results.effectiveRSI)}</td>
                  <td className="border px-4 py-2">{formatRSIR(results.effectiveCompliance.minRSI)}</td>
                  <td className="border px-4 py-2">
                    {results.effectiveCompliance.compliant ? 
                      <span className="text-green-600 font-bold">Conforme ✓</span> : 
                      <span className="text-red-600 font-bold">Non conforme ✗</span>}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded">
            <p className="text-sm">
              <strong>Note:</strong> La résistance thermique effective (RSI<sub>E</sub>) prend en compte l'impact des ponts thermiques. 
              Pour une analyse plus précise, consultez la fiche technique <em>"Efficacité énergétique – Explication des résistances thermiques totale (RSI<sub>T</sub>) et effective (RSI<sub>E</sub>)"</em>.
            </p>
          </div>
        </div>
      )}
    </div>
  );
};

// Rendu du composant principal
ReactDOM.render(<Calculator />, document.getElementById('root'));
    </script>
</body>
</html>
